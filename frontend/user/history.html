<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History Transaksi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">
    <div id="navbar-container"></div>

    <div class="container mt-4">
        <h4 class="mb-3">Riwayat Pembelian Paket</h4>
        <div class="card shadow-sm">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Tanggal</th>
                                <th>Paket</th>
                                <th>Harga</th>
                                <th>Durasi</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody">
                            <tr><td colspan="4" class="text-center">Memuat...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function(){
            $("#navbar-container").load("navbar.html");
            
            const userId = localStorage.getItem('user_id');
            if(!userId) window.location.href = '../index.html';

            $.get('../../backend/api/transactions.php?user_id=' + userId, function(data){
                let rows = '';
                function formatSeconds(sec){
                    sec = parseInt(sec) || 0;
                    const hours = Math.floor(sec / 3600);
                    const minutes = Math.floor((sec % 3600) / 60);
                    const seconds = sec % 60;
                    const hh = String(hours).padStart(2, '0');
                    const mm = String(minutes).padStart(2, '0');
                    const ss = String(seconds).padStart(2, '0');
                    return `${hh}:${mm}:${ss}`;
                }

                if(!Array.isArray(data) || data.length === 0) {
                    rows = '<tr><td colspan="4" class="text-center">Belum ada transaksi</td></tr>';
                } else {
                    data.forEach(t => {
                        rows += `
                        <tr>
                            <td>${t.created_at}</td>
                            <td>${t.paket_name || 'Voucher Custom'}</td>
                            <td>Rp ${parseInt(t.billing_amount).toLocaleString()}</td>
                            <td>${formatSeconds(t.seconds_added)}</td>
                        </tr>`;
                    });
                }
                $('#historyBody').html(rows);
            });
        });
    </script>
</body>
</html>